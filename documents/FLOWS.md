# ğŸ”„ Flujos y Procesos de Negocio

## VisiÃ³n General de Procesos

Este documento describe los principales flujos de negocio implementados en EduGo API Mobile.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJOS PRINCIPALES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Subida de Material      â†’ Docente sube PDF                      â”‚
â”‚  2. Procesamiento IA        â†’ Worker genera summary + quiz          â”‚
â”‚  3. Lectura de Material     â†’ Estudiante lee y trackea progreso     â”‚
â”‚  4. EvaluaciÃ³n              â†’ Estudiante completa quiz              â”‚
â”‚  5. AutenticaciÃ³n           â†’ Login via api-admin                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ Flujo: Subida de Material

### DescripciÃ³n
Un docente sube un nuevo material educativo (PDF) al sistema.

### Diagrama de Secuencia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docente â”‚     â”‚  API Mobile  â”‚     â”‚   S3    â”‚     â”‚ RabbitMQ â”‚     â”‚  Worker  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚ 1. POST /materials                  â”‚               â”‚                â”‚
     â”‚ (title, desc)    â”‚                  â”‚               â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚  Material creado â”‚                  â”‚               â”‚                â”‚
     â”‚  (status=uploaded)                  â”‚               â”‚                â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚ 2. POST /materials/:id/upload-url   â”‚               â”‚                â”‚
     â”‚ (filename, type) â”‚                  â”‚               â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚ Generate presigned URL           â”‚                â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚  upload_url      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚ 3. PUT upload_url (archivo PDF)     â”‚               â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚  200 OK          â”‚                  â”‚               â”‚                â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚ 4. POST /materials/:id/upload-complete              â”‚                â”‚
     â”‚ (file_url, type, size)              â”‚               â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚ Update material status           â”‚                â”‚
     â”‚                  â”‚ (processing)     â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚ Publish event    â”‚               â”‚                â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚  204 No Content  â”‚                  â”‚               â”‚ Consume event  â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚ Download PDF   â”‚
     â”‚                  â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚ Generate       â”‚
     â”‚                  â”‚                  â”‚               â”‚ Summary + Quiz â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚                  â”‚               â”‚ Save to MongoDBâ”‚
     â”‚                  â”‚                  â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
     â”‚                  â”‚ Update status (ready)            â”‚                â”‚
     â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                  â”‚               â”‚                â”‚
```

### Estados del Material

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ uploaded â”‚â”€â”€â”€â”€â–¶â”‚ processing â”‚â”€â”€â”€â”€â–¶â”‚ ready â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ failed â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Endpoints Involucrados

| Paso | Endpoint | MÃ©todo |
|------|----------|--------|
| 1 | `/v1/materials` | POST |
| 2 | `/v1/materials/:id/upload-url` | POST |
| 3 | S3 Presigned URL | PUT |
| 4 | `/v1/materials/:id/upload-complete` | POST |

---

## 2ï¸âƒ£ Flujo: Procesamiento IA (Worker)

### DescripciÃ³n
El Worker procesa el PDF subido y genera automÃ¡ticamente un resumen y quiz.

### Diagrama de Proceso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WORKER PROCESS                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RabbitMQ      â”‚
                    â”‚ material.uploadedâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Consume Event  â”‚
                    â”‚  material_id    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Download PDF   â”‚
                    â”‚  from S3        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Extract Text   â”‚
                    â”‚  (PDF parsing)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Generate       â”‚           â”‚  Generate       â”‚
     â”‚  Summary        â”‚           â”‚  Quiz           â”‚
     â”‚  (OpenAI GPT-4) â”‚           â”‚  (OpenAI GPT-4) â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â–¼                              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Save to        â”‚           â”‚  Save to        â”‚
     â”‚  MongoDB        â”‚           â”‚  MongoDB        â”‚
     â”‚  (summaries)    â”‚           â”‚  (assessments)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Update Materialâ”‚
                    â”‚  status = ready â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Datos Generados

**Summary (MongoDB: summaries)**
```json
{
  "material_id": "...",
  "summary_text": "Resumen del documento...",
  "key_points": ["punto 1", "punto 2"],
  "reading_time_minutes": 5
}
```

**Assessment (MongoDB: assessments)**
```json
{
  "material_id": "...",
  "questions": [
    {
      "id": "q1",
      "question_text": "Â¿CuÃ¡l es...?",
      "options": [...],
      "correct_answer": "b"
    }
  ],
  "total_questions": 10
}
```

---

## 3ï¸âƒ£ Flujo: Lectura de Material y Progreso

### DescripciÃ³n
Un estudiante lee un material y el sistema trackea su progreso.

### Diagrama de Secuencia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estudiante â”‚     â”‚  API Mobile  â”‚     â”‚ PostgreSQL â”‚     â”‚   S3    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ 1. GET /materials â”‚                   â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚                   â”‚ Query materials   â”‚                 â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚  [materials]      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ 2. GET /materials/:id/download-url    â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚                   â”‚ Generate presigned URL              â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚  download_url     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ 3. GET download_url (PDF)             â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚  PDF file         â”‚                   â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ [Usuario lee pÃ¡gina por pÃ¡gina]       â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ 4. PUT /progress  â”‚                   â”‚                 â”‚
      â”‚ (progress: 25%)   â”‚                   â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚                   â”‚ UPSERT progress   â”‚                 â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚  {updated}        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ [ContinÃºa leyendo]â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚ 5. PUT /progress  â”‚                   â”‚                 â”‚
      â”‚ (progress: 100%)  â”‚                   â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚                   â”‚ UPSERT + mark completed             â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
      â”‚                   â”‚                   â”‚                 â”‚
      â”‚  {completed}      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
```

### Estructura de Progreso

```
progress (PostgreSQL)
â”œâ”€â”€ user_id          â†’ Estudiante
â”œâ”€â”€ material_id      â†’ Material
â”œâ”€â”€ progress_percentage â†’ 0-100%
â”œâ”€â”€ last_page        â†’ Ãšltima pÃ¡gina leÃ­da
â”œâ”€â”€ time_spent_seconds â†’ Tiempo total
â”œâ”€â”€ started_at       â†’ Primera vez que abriÃ³
â”œâ”€â”€ last_accessed_at â†’ Ãšltima interacciÃ³n
â””â”€â”€ completed_at     â†’ Cuando llegÃ³ a 100%
```

### Idempotencia

El endpoint `PUT /v1/progress` es **idempotente**:

```sql
INSERT INTO progress (user_id, material_id, progress_percentage, last_page)
VALUES ($1, $2, $3, $4)
ON CONFLICT (user_id, material_id)
DO UPDATE SET
    progress_percentage = EXCLUDED.progress_percentage,
    last_page = EXCLUDED.last_page,
    last_accessed_at = NOW(),
    updated_at = NOW();
```

---

## 4ï¸âƒ£ Flujo: EvaluaciÃ³n (Quiz)

### DescripciÃ³n
Un estudiante completa una evaluaciÃ³n y recibe feedback inmediato.

### Diagrama de Secuencia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estudiante â”‚     â”‚  API Mobile  â”‚     â”‚ MongoDB â”‚     â”‚ PostgreSQL â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚ 1. GET /materials/:id/assessment     â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚ Find assessment  â”‚                 â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚ Assessment (sin respuestas)        â”‚
      â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚  questions[]      â”‚                  â”‚                 â”‚
      â”‚  (sin correct_answer)                â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚ [Estudiante responde preguntas]      â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚ 2. POST /materials/:id/assessment/attempts             â”‚
      â”‚    {answers: [...], time_spent}      â”‚                 â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚ Get assessment with answers        â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚                   â”‚ â”‚ SCORING ENGINE              â”‚   â”‚
      â”‚                   â”‚ â”‚ â€¢ Compare answers           â”‚   â”‚
      â”‚                   â”‚ â”‚ â€¢ Calculate score           â”‚   â”‚
      â”‚                   â”‚ â”‚ â€¢ Generate feedback         â”‚   â”‚
      â”‚                   â”‚ â”‚ â€¢ Determine pass/fail       â”‚   â”‚
      â”‚                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚ Save attempt     â”‚                 â”‚
      â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚                   â”‚                  â”‚  Save attempt  â”‚
      â”‚                   â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                   â”‚                  â”‚                 â”‚
      â”‚  {score, passed,  â”‚                  â”‚                 â”‚
      â”‚   feedback[]}     â”‚                  â”‚                 â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                 â”‚
      â”‚                   â”‚                  â”‚                 â”‚
```

### Scoring Engine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SCORING ENGINE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Input:                                                             â”‚
â”‚  â”œâ”€â”€ Assessment (questions + correct_answers)                       â”‚
â”‚  â””â”€â”€ UserAnswers (question_id â†’ selected_answer)                    â”‚
â”‚                                                                     â”‚
â”‚  Process:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ for each question:                                           â”‚   â”‚
â”‚  â”‚   â€¢ Compare user_answer with correct_answer                  â”‚   â”‚
â”‚  â”‚   â€¢ Mark as correct/incorrect                                â”‚   â”‚
â”‚  â”‚   â€¢ Generate feedback message                                â”‚   â”‚
â”‚  â”‚   â€¢ Include explanation if incorrect                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Output:                                                            â”‚
â”‚  â”œâ”€â”€ score: (correct/total) * 100                                  â”‚
â”‚  â”œâ”€â”€ passed: score >= pass_threshold                               â”‚
â”‚  â”œâ”€â”€ correct_answers: count                                        â”‚
â”‚  â””â”€â”€ feedback[]: detailed per-question feedback                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Respuesta del Quiz

```json
{
  "attempt_id": "uuid",
  "score": 80,
  "max_score": 100,
  "correct_answers": 8,
  "total_questions": 10,
  "pass_threshold": 70,
  "passed": true,
  "feedback": [
    {
      "question_id": "q1",
      "question_text": "Â¿CuÃ¡l es la derivada de xÂ²?",
      "selected_option": "2x",
      "correct_answer": "2x",
      "is_correct": true,
      "message": "Â¡Correcto!"
    },
    {
      "question_id": "q2",
      "question_text": "...",
      "selected_option": "a",
      "correct_answer": "c",
      "is_correct": false,
      "message": "Incorrecto. La respuesta correcta es..."
    }
  ]
}
```

---

## 5ï¸âƒ£ Flujo: AutenticaciÃ³n

### DescripciÃ³n
La autenticaciÃ³n es manejada por `api-admin`. API Mobile solo valida tokens.

### Diagrama de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente  â”‚     â”‚  api-admin   â”‚     â”‚  api-mobile  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚
      â”‚ 1. POST /auth/login                    â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚  {access_token,   â”‚                    â”‚
      â”‚   refresh_token}  â”‚                    â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚ 2. GET /v1/materials                   â”‚
      â”‚ Authorization: Bearer {access_token}   â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                   â”‚                    â”‚
      â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                   â”‚   â”‚ JWT Validation                  â”‚
      â”‚                   â”‚   â”‚ â€¢ Verify signature (local)      â”‚
      â”‚                   â”‚   â”‚ â€¢ Check expiration              â”‚
      â”‚                   â”‚   â”‚ â€¢ Extract claims                â”‚
      â”‚                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚
      â”‚  [materials]      â”‚                    â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                   â”‚                    â”‚
```

### ValidaciÃ³n JWT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     JWT VALIDATION FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Request with Authorization: Bearer {token}                         â”‚
â”‚                          â”‚                                          â”‚
â”‚                          â–¼                                          â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                 â”‚ Parse JWT Token â”‚                                 â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                          â”‚                                          â”‚
â”‚                          â–¼                                          â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                 â”‚ Verify Signatureâ”‚                                 â”‚
â”‚                 â”‚ (with JWT_SECRET)                                 â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                          â”‚                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚              â”‚ Valid?                â”‚                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚
â”‚         â”‚   NO    â”‚             â”‚   YES   â”‚                         â”‚
â”‚         â–¼         â”‚             â–¼         â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                         â”‚
â”‚   â”‚ 401 Error â”‚   â”‚     â”‚ Check Expiry  â”‚ â”‚                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                         â”‚
â”‚                   â”‚             â”‚         â”‚                         â”‚
â”‚                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                         â”‚
â”‚                   â”‚    â”‚ Expired?        â”‚â”‚                         â”‚
â”‚                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                         â”‚
â”‚                   â”‚        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”‚                         â”‚
â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â” â”‚                         â”‚
â”‚                   â”‚   â”‚  YES  â”‚ â”‚  NO   â”‚ â”‚                         â”‚
â”‚                   â”‚   â–¼       â”‚ â–¼       â”‚ â”‚                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚ 401 Error â”‚   â”‚ â”‚Extract Claims â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â€¢ user_id     â”‚                    â”‚
â”‚                              â”‚ â”‚ â€¢ email       â”‚                    â”‚
â”‚                              â”‚ â”‚ â€¢ role        â”‚                    â”‚
â”‚                              â”‚ â”‚ â€¢ school_id   â”‚                    â”‚
â”‚                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                              â”‚         â”‚                            â”‚
â”‚                              â”‚         â–¼                            â”‚
â”‚                              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                              â”‚ â”‚ Set Context   â”‚                    â”‚
â”‚                              â”‚ â”‚ Continue...   â”‚                    â”‚
â”‚                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                              â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Flujo: EstadÃ­sticas

### EstadÃ­sticas por Material

```
GET /v1/materials/:id/stats

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  progress   â”‚     â”‚  attempts   â”‚     â”‚ assessments â”‚           â”‚
â”‚  â”‚  (Postgres) â”‚     â”‚  (Postgres) â”‚     â”‚  (MongoDB)  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                   â”‚                   â”‚                   â”‚
â”‚         â”‚ COUNT users       â”‚ COUNT attempts    â”‚ AVG score         â”‚
â”‚         â”‚ AVG progress      â”‚ AVG score         â”‚                   â”‚
â”‚         â”‚                   â”‚                   â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                   â”‚                   â”‚                             â”‚
â”‚                   â–¼                   â–¼                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚           StatsService               â”‚                     â”‚
â”‚         â”‚  â€¢ Aggregate data                   â”‚                     â”‚
â”‚         â”‚  â€¢ Calculate completion_rate        â”‚                     â”‚
â”‚         â”‚  â€¢ Calculate average_progress       â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                           â”‚                                         â”‚
â”‚                           â–¼                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚ Response:                           â”‚                     â”‚
â”‚         â”‚  â€¢ total_views                      â”‚                     â”‚
â”‚         â”‚  â€¢ unique_users                     â”‚                     â”‚
â”‚         â”‚  â€¢ average_progress                 â”‚                     â”‚
â”‚         â”‚  â€¢ completion_rate                  â”‚                     â”‚
â”‚         â”‚  â€¢ average_assessment_score         â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### EstadÃ­sticas Globales

```
GET /v1/stats/global

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  Queries ejecutados:                                                â”‚
â”‚                                                                     â”‚
â”‚  â€¢ MaterialRepository.CountPublishedMaterials()                     â”‚
â”‚    â†’ SELECT COUNT(*) FROM materials WHERE status = 'ready'          â”‚
â”‚                                                                     â”‚
â”‚  â€¢ ProgressRepository.CountActiveUsers()                            â”‚
â”‚    â†’ SELECT COUNT(DISTINCT user_id) FROM progress                   â”‚
â”‚      WHERE last_accessed_at >= NOW() - INTERVAL '30 days'           â”‚
â”‚                                                                     â”‚
â”‚  â€¢ ProgressRepository.CalculateAverageProgress()                    â”‚
â”‚    â†’ SELECT AVG(progress_percentage) FROM progress                  â”‚
â”‚                                                                     â”‚
â”‚  â€¢ AssessmentRepository.CountCompletedAssessments()                 â”‚
â”‚    â†’ db.assessment_results.countDocuments()                         â”‚
â”‚                                                                     â”‚
â”‚  â€¢ AssessmentRepository.CalculateAverageScore()                     â”‚
â”‚    â†’ db.assessment_results.aggregate([{$group: {_id: null,          â”‚
â”‚        avgScore: {$avg: "$score"}}}])                               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Ciclo de Vida Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CICLO DE VIDA COMPLETO                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     DOCENTE                           SISTEMA                        ESTUDIANTE
        â”‚                                â”‚                                â”‚
        â”‚ 1. Crear material              â”‚                                â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚
        â”‚                                â”‚                                â”‚
        â”‚ 2. Subir PDF a S3              â”‚                                â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚
        â”‚                                â”‚                                â”‚
        â”‚ 3. Notificar upload            â”‚                                â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 4. Procesar PDF (Worker)       â”‚
        â”‚                                â”‚ â€¢ Generar summary              â”‚
        â”‚                                â”‚ â€¢ Generar quiz                 â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 5. Material "ready"            â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 6. Ver materiales disponibles  â”‚
        â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 7. Descargar y leer PDF        â”‚
        â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 8. Trackear progreso           â”‚
        â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 9. Obtener quiz                â”‚
        â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 10. Enviar respuestas          â”‚
        â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                                â”‚
        â”‚                                â”‚ 11. Recibir feedback           â”‚
        â”‚                                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
        â”‚                                â”‚                                â”‚
        â”‚ 12. Ver estadÃ­sticas           â”‚                                â”‚
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚
        â”‚                                â”‚                                â”‚
```

---

## ğŸ“ Notas de ImplementaciÃ³n

### Idempotencia
- `PUT /progress` es idempotente usando `ON CONFLICT DO UPDATE`
- MÃºltiples llamadas con mismos datos no crean duplicados

### Resiliencia
- RabbitMQ y S3 son **opcionales** en modo desarrollo
- Circuit breaker para llamadas externas
- Graceful degradation si servicios no disponibles

### Seguridad
- JWT validaciÃ³n local por defecto (rÃ¡pido)
- Fallback a validaciÃ³n remota (api-admin) opcional
- Respuestas correctas NUNCA se envÃ­an antes de completar quiz
