# Configuración Base - API Mobile
# Valores comunes a todos los ambientes

server:
  port: 8080
  host: "localhost"
  read_timeout: 30s
  write_timeout: 30s

database:
  postgres:
    host: "localhost"
    port: 5432
    database: "edugo"
    user: "edugo"
    # password: Set via DATABASE_POSTGRES_PASSWORD environment variable
    max_connections: 25
    ssl_mode: "disable"

  mongodb:
    # uri: Set via DATABASE_MONGODB_URI environment variable (includes credentials)
    database: "edugo"
    timeout: 10s

messaging:
  rabbitmq:
    # url: Set via MESSAGING_RABBITMQ_URL environment variable (includes credentials)
    queues:
      material_uploaded: "edugo.material.uploaded"
      assessment_attempt: "edugo.assessment.attempt"
    exchanges:
      materials: "edugo.materials"
    prefetch_count: 10
    # Circuit Breaker para resiliencia ante fallos de RabbitMQ
    circuit_breaker:
      enabled: true # Habilitar circuit breaker
      max_requests: 3 # Requests permitidos en estado half-open
      interval: 60s # Intervalo para resetear contadores
      timeout: 30s # Tiempo en estado open antes de half-open
      failure_threshold: 5 # Fallos consecutivos para abrir circuito

storage:
  s3:
    region: "us-east-1"
    bucket_name: "edugo-materials"
    # access_key_id: Set via STORAGE_S3_ACCESS_KEY_ID environment variable
    # secret_access_key: Set via STORAGE_S3_SECRET_ACCESS_KEY environment variable
    endpoint: "" # Optional, for Localstack in development

logging:
  level: "info"
  format: "json"

# Autenticación JWT
# IMPORTANTE: El secret e issuer DEBEN coincidir con api-admin para validación local
auth:
  jwt:
    # secret: Set via AUTH_JWT_SECRET environment variable (DEBE ser el mismo que api-admin)
    issuer: "edugo-central" # Issuer del token JWT (DEBE ser el mismo que api-admin)
  api_admin:
    # Validación remota DESHABILITADA por defecto - se usa validación local con JWT
    # base_url: Set via AUTH_API_ADMIN_BASE_URL if remote validation is needed
    timeout: 5s
    cache_ttl: 60s
    cache_enabled: true
    remote_enabled: false # Validación remota deshabilitada por defecto
    fallback_enabled: false # Fallback remoto deshabilitado por defecto

bootstrap:
  optional_resources:
    # RabbitMQ is optional by default to facilitate local development
    # Set to false to make it required (will fail if unavailable)
    rabbitmq: true
    # S3 is optional by default to facilitate local development
    # Set to false to make it required (will fail if unavailable)
    s3: true

# Development mode configuration
development:
  # Use mock repositories instead of real database connections
  # Perfect for frontend development without Docker
  # Set via DEVELOPMENT_USE_MOCK_REPOSITORIES environment variable
  # Values: true (mock) | false (real databases)
  use_mock_repositories: false
