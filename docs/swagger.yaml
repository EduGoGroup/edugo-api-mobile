basePath: /
definitions:
  dto.CreateMaterialRequest:
    properties:
      description:
        example: A comprehensive guide to differential and integral calculus
        maxLength: 1000
        type: string
      subject_id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      title:
        example: Introduction to Calculus
        maxLength: 200
        minLength: 3
        type: string
    required:
    - title
    type: object
  dto.GenerateDownloadURLResponse:
    properties:
      download_url:
        example: https://s3.amazonaws.com/bucket/materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf?X-Amz-Algorithm=...
        type: string
      expires_in:
        description: En segundos
        example: 3600
        type: integer
    type: object
  dto.GenerateUploadURLRequest:
    properties:
      content_type:
        example: application/pdf
        type: string
      file_name:
        example: calculus.pdf
        type: string
    required:
    - content_type
    - file_name
    type: object
  dto.GenerateUploadURLResponse:
    properties:
      expires_in:
        description: En segundos
        example: 900
        type: integer
      s3_key:
        example: materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf
        type: string
      upload_url:
        example: https://s3.amazonaws.com/bucket/materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf?X-Amz-Algorithm=...
        type: string
    type: object
  dto.LoginRequest:
    properties:
      email:
        example: user@example.com
        type: string
      password:
        example: password123
        minLength: 6
        type: string
    required:
    - email
    - password
    type: object
  dto.LoginResponse:
    properties:
      access_token:
        description: JWT access token
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        type: string
      expires_in:
        description: Segundos hasta expiración
        example: 3600
        type: integer
      refresh_token:
        description: Refresh token para renovar
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      token_type:
        description: Siempre "Bearer"
        example: Bearer
        type: string
      user:
        allOf:
        - $ref: '#/definitions/dto.UserInfo'
        description: Información del usuario
    type: object
  dto.MaterialResponse:
    properties:
      author_id:
        example: 660e8400-e29b-41d4-a716-446655440001
        type: string
      created_at:
        example: "2024-01-15T10:30:00Z"
        type: string
      description:
        example: A comprehensive guide to differential and integral calculus
        type: string
      id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      processing_status:
        example: completed
        type: string
      s3_key:
        example: materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf
        type: string
      s3_url:
        example: https://s3.amazonaws.com/bucket/materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf
        type: string
      status:
        example: published
        type: string
      subject_id:
        example: 770e8400-e29b-41d4-a716-446655440002
        type: string
      title:
        example: Introduction to Calculus
        type: string
      updated_at:
        example: "2024-01-15T10:30:00Z"
        type: string
    type: object
  dto.MaterialVersionResponse:
    properties:
      changed_by:
        example: 660e8400-e29b-41d4-a716-446655440001
        type: string
      content_url:
        example: https://s3.amazonaws.com/bucket/materials/550e8400-e29b-41d4-a716-446655440000/calculus-v2.pdf
        type: string
      created_at:
        example: "2024-01-20T14:30:00Z"
        type: string
      id:
        example: 880e8400-e29b-41d4-a716-446655440003
        type: string
      title:
        example: Introduction to Calculus - Updated
        type: string
      version_number:
        example: 2
        type: integer
    type: object
  dto.MaterialWithVersionsResponse:
    properties:
      material:
        $ref: '#/definitions/dto.MaterialResponse'
      versions:
        items:
          $ref: '#/definitions/dto.MaterialVersionResponse'
        type: array
    type: object
  dto.RefreshRequest:
    properties:
      refresh_token:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    required:
    - refresh_token
    type: object
  dto.RefreshResponse:
    properties:
      access_token:
        description: Nuevo JWT access token
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        type: string
      expires_in:
        description: Segundos hasta expiración
        example: 3600
        type: integer
      token_type:
        description: Siempre "Bearer"
        example: Bearer
        type: string
    type: object
  dto.UploadCompleteRequest:
    properties:
      s3_key:
        example: materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf
        type: string
      s3_url:
        example: https://s3.amazonaws.com/bucket/materials/550e8400-e29b-41d4-a716-446655440000/calculus.pdf
        type: string
    type: object
  dto.UserInfo:
    properties:
      email:
        example: user@example.com
        type: string
      first_name:
        example: John
        type: string
      full_name:
        example: John Doe
        type: string
      id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      last_name:
        example: Doe
        type: string
      role:
        example: student
        type: string
    type: object
  handler.ErrorResponse:
    properties:
      code:
        example: INVALID_REQUEST
        type: string
      error:
        example: invalid request body
        type: string
    type: object
  handler.HealthResponse:
    properties:
      mongodb:
        type: string
      postgres:
        type: string
      service:
        type: string
      status:
        type: string
      timestamp:
        type: string
      version:
        type: string
    type: object
  handler.ProgressResponse:
    properties:
      last_page:
        example: 45
        type: integer
      material_id:
        example: 660e8400-e29b-41d4-a716-446655440001
        type: string
      message:
        example: progress updated successfully
        type: string
      progress_percentage:
        example: 75
        type: integer
      user_id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    type: object
  handler.SubmitAssessmentRequest:
    type: object
  handler.UpsertProgressRequest:
    properties:
      last_page:
        example: 45
        type: integer
      material_id:
        example: 660e8400-e29b-41d4-a716-446655440001
        type: string
      progress_percentage:
        example: 75
        maximum: 100
        minimum: 0
        type: integer
      user_id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    required:
    - material_id
    - progress_percentage
    - user_id
    type: object
info:
  contact:
    email: soporte@edugo.com
    name: Equipo EduGo
  description: API para operaciones frecuentes de docentes y estudiantes en EduGo
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: http://edugo.com/terms/
  title: EduGo API Mobile
  version: "1.0"
paths:
  /health:
    get:
      description: Verifica que la API y sus dependencias (PostgreSQL, MongoDB) estén
        funcionando correctamente
      produces:
      - application/json
      responses:
        "200":
          description: System is healthy or degraded with status details
          schema:
            $ref: '#/definitions/handler.HealthResponse'
        "500":
          description: System is unhealthy
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Health check
      tags:
      - health
  /v1/assessments/{id}/submit:
    post:
      consumes:
      - application/json
      description: Calcula automáticamente el puntaje de una evaluación y genera feedback
        detallado por pregunta
      parameters:
      - description: Assessment ID (Material ID)
        in: path
        name: id
        required: true
        type: string
      - description: User responses
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.SubmitAssessmentRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Resultado con score y feedback detallado
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request or assessment_id
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Assessment not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: Assessment already completed by user
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Submit assessment with automatic scoring and detailed feedback
      tags:
      - assessments
  /v1/auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user with email and password, returns JWT access token
        and refresh token
      parameters:
      - description: Login credentials (email and password)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Successfully authenticated, returns tokens and user info
          schema:
            $ref: '#/definitions/dto.LoginResponse'
        "400":
          description: Invalid request body
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Invalid credentials
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: User login
      tags:
      - auth
  /v1/auth/logout:
    post:
      consumes:
      - application/json
      description: Revoca el refresh token del usuario (cierra sesión). Requiere autenticación
        con Bearer token.
      parameters:
      - description: Refresh token a revocar
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.RefreshRequest'
      produces:
      - application/json
      responses:
        "204":
          description: No content - Logout exitoso
        "400":
          description: Invalid request body
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: User not authenticated or invalid token
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: User logout
      tags:
      - auth
  /v1/auth/refresh:
    post:
      consumes:
      - application/json
      description: Obtiene un nuevo access token usando un refresh token válido
      parameters:
      - description: Refresh token to exchange for new access token
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.RefreshRequest'
      produces:
      - application/json
      responses:
        "200":
          description: New access token generated successfully
          schema:
            $ref: '#/definitions/dto.RefreshResponse'
        "400":
          description: Invalid request body
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Invalid or expired refresh token
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: Refresh access token
      tags:
      - auth
  /v1/auth/revoke-all:
    post:
      description: Revoca todos los refresh tokens del usuario (cierra todas las sesiones
        activas). Requiere autenticación con Bearer token.
      produces:
      - application/json
      responses:
        "204":
          description: No content - Todas las sesiones revocadas exitosamente
        "401":
          description: User not authenticated
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Revoke all sessions
      tags:
      - auth
  /v1/materials:
    get:
      description: Retrieves a list of all educational materials available in the
        system
      produces:
      - application/json
      responses:
        "200":
          description: List of materials retrieved successfully
          schema:
            items:
              $ref: '#/definitions/dto.MaterialResponse'
            type: array
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: List all materials
      tags:
      - materials
    post:
      consumes:
      - application/json
      description: Creates a new educational material with title, description, and
        optional subject. Requires authentication.
      parameters:
      - description: Material data (title, description, subject_id)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.CreateMaterialRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Material created successfully
          schema:
            $ref: '#/definitions/dto.MaterialResponse'
        "400":
          description: Invalid request body or validation error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: User not authenticated
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create a new material
      tags:
      - materials
  /v1/materials/{id}:
    get:
      description: Retrieves a specific educational material by its unique identifier
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Material found successfully
          schema:
            $ref: '#/definitions/dto.MaterialResponse'
        "400":
          description: Invalid material ID format
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Material not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get material by ID
      tags:
      - materials
  /v1/materials/{id}/assessment:
    get:
      description: Retrieves the assessment (quiz/test) associated with a specific
        material
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Assessment retrieved successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid material ID format
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Assessment not found for this material
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get material assessment/quiz
      tags:
      - assessments
  /v1/materials/{id}/assessment/attempts:
    post:
      consumes:
      - application/json
      description: Records a user's attempt at completing an assessment with their
        answers
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      - description: User answers (question_id -> answer mapping)
        in: body
        name: request
        required: true
        schema:
          additionalProperties: true
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Attempt recorded successfully with score
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request body or material ID
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: User not authenticated
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Assessment not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Record assessment attempt
      tags:
      - assessments
  /v1/materials/{id}/download-url:
    get:
      description: Generate a presigned URL for downloading a material file from S3
      parameters:
      - description: Material ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.GenerateDownloadURLResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Generate presigned download URL
      tags:
      - materials
  /v1/materials/{id}/progress:
    patch:
      consumes:
      - application/json
      description: Updates user's reading progress for a material (percentage and
        last page read). Legacy endpoint - consider using PUT /progress instead.
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      - description: Progress data (percentage, last_page)
        in: body
        name: request
        required: true
        schema:
          additionalProperties:
            type: integer
          type: object
      produces:
      - application/json
      responses:
        "204":
          description: Progress updated successfully
        "400":
          description: Invalid request body or material ID
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: User not authenticated
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Update reading progress (legacy endpoint)
      tags:
      - progress
  /v1/materials/{id}/stats:
    get:
      description: Retrieves statistics for a specific material including views, completion
        rate, and average score
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Material statistics retrieved successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid material ID format
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Material not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get material statistics
      tags:
      - stats
  /v1/materials/{id}/summary:
    get:
      description: Retrieves an AI-generated summary of the material content
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Summary retrieved successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid material ID format
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Summary not found for this material
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get material summary
      tags:
      - materials
  /v1/materials/{id}/upload-complete:
    post:
      consumes:
      - application/json
      description: Notifies the system that a PDF file has been successfully uploaded
        to S3
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      - description: S3 key and URL information
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.UploadCompleteRequest'
      produces:
      - application/json
      responses:
        "204":
          description: Upload notification processed successfully
        "400":
          description: Invalid request body or material ID
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Material not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Notify upload complete
      tags:
      - materials
  /v1/materials/{id}/upload-url:
    post:
      consumes:
      - application/json
      description: Generate a presigned URL for uploading a material file to S3
      parameters:
      - description: Material ID
        in: path
        name: id
        required: true
        type: string
      - description: Upload URL request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.GenerateUploadURLRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.GenerateUploadURLResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Generate presigned upload URL
      tags:
      - materials
  /v1/materials/{id}/versions:
    get:
      description: Get a material including its complete version history
      parameters:
      - description: Material ID (UUID format)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.MaterialWithVersionsResponse'
        "400":
          description: Invalid UUID format
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: Material not found
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get material with version history
      tags:
      - materials
  /v1/progress:
    put:
      consumes:
      - application/json
      description: Updates user progress in a material using idempotent UPSERT operation.
        Multiple calls with same data are safe.
      parameters:
      - description: Progress data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.UpsertProgressRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Progress updated successfully
          schema:
            $ref: '#/definitions/handler.ProgressResponse'
        "400":
          description: Invalid request (bad UUID, percentage out of range)
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "403":
          description: Forbidden (user can only update own progress)
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Upsert progress idempotently (new UPSERT endpoint)
      tags:
      - progress
  /v1/stats/global:
    get:
      description: Obtiene estadísticas globales del sistema (solo admins)
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "403":
          description: Forbidden - solo admins
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get global system statistics
      tags:
      - stats
securityDefinitions:
  BearerAuth:
    description: 'JWT token con formato: Bearer {token}'
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
